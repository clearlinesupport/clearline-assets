```markdown
# Agents.md for Clearline Field Systems

This Agents.md file provides guidance for OpenAI Codex (and similar AI agents) when working with the Clearline Field Systems codebase. It explains project structure, coding conventions, testing protocols, and deployment practices—now updated for Cloudflare hosting. Use this document to ensure any AI-generated code aligns precisely with our standards.

---

## Table of Contents

- [Project Overview](#project-overview)  
- [Repository Structure](#repository-structure)  
- [Coding Conventions](#coding-conventions)  
  - [General Rules](#general-rules)  
  - [JavaScript / TypeScript](#javascript--typescript)  
  - [HTML / CSS](#html--css)  
- [Testing Protocols](#testing-protocols)  
- [Pull Request Guidelines](#pull-request-guidelines)  
- [Build & Deployment (Cloudflare)](#build--deployment-cloudflare)  
- [Security & Compliance](#security--compliance)  
- [Contact & Support](#contact--support)

---

## Project Overview

Clearline Field Systems is a small‐scale IT support and field services provider serving government offices and small businesses in Albany/Rensselaer County, NY. The primary repository contains:

1. A **static website** (HTML, CSS, JavaScript) for marketing, quoting, and documentation.  
2. A **Workstation Quote Calculator** (JavaScript-based form) that clients use to generate PC build quotes.  
3. A folder of **PDF templates** and **official documents** (COI, W9, EIN, Articles) for easy download.  
4. A set of **automation scripts** (Node.js) for tasks like generating PDF invoices or sending SMS via Twilio.  

Any AI agent (OpenAI Codex or equivalent) should use this Agents.md to understand how files are organized, which conventions to follow, and how to run tests, builds, and deployments under Cloudflare.

---

## Repository Structure

```

/ (root)
├── README.md
├── AGENTS.md
├── package.json
├── tsconfig.json
├── .eslintrc.json
├── .gitignore
├── /site
│   ├── index.html
│   ├── about.html
│   ├── contact.html
│   ├── /assets
│   │   ├── /css
│   │   │   └── main.css
│   │   ├── /js
│   │   │   ├── calculator.js
│   │   │   └── tracking.js
│   │   └── /images
│   │       └── logo.png
│   ├── /partials
│   │   ├── header.html
│   │   └── footer.html
│   └── /templates
│       ├── quote-template.html
│       └── invoice-template.html
├── /automations
│   ├── generate-pdf.js
│   ├── send-sms.js
│   └── email-notification.js
├── /docs
│   ├── COI.pdf
│   ├── W9.pdf
│   ├── EIN.pdf
│   └── Articles-of-Organization.pdf
└── /tests
├── calculator.test.js
├── pdf-generation.test.js
└── email-notification.test.js

````

- **`/site`**  
  - Contains all static pages served to potential clients.  
  - `/assets/css`: CSS files (utility classes, custom styles).  
  - `/assets/js`: JavaScript for interactive features (quote calculator, analytics).  
  - `/partials`: HTML fragments (header, footer) included via build script or static-site generator.  
  - `/templates`: HTML templates used by automation scripts (quotes, invoices).  

- **`/automations`**  
  - Node.js scripts that perform backend tasks (PDF generation, SMS notifications, email sending).  

- **`/docs`**  
  - Official PDFs (COI, W9, EIN, Articles).  
  - These files should not be altered by Codex–generated scripts.  

- **`/tests`**  
  - Unit tests (Jest) for calculator logic, PDF generation, and email notifications.  
  - Tests help verify that any AI‐generated code does not break core functionality.  

---

## Coding Conventions

Agents.md instructs AI agents to generate code that conforms to Clearline’s style. Follow these rules precisely:

### General Rules

- Use **4-space indentation**.  
- Use **Unix line endings** (`\n`).  
- Use **UTF-8** encoding for all files.  
- All source files must reside in one of the folders defined in “Repository Structure.”  
- No global variables: always wrap logic in functions or modules.  
- Add a comment block at the top of every generated file that includes:
  1. File name  
  2. Description of purpose  
  3. Author (set to “Generated by OpenAI Codex on YYYY-MM-DD”)  
  4. License note: “© 2025 Clearline Field Systems. All rights reserved.”  

---

### JavaScript / TypeScript

- All new scripts should use **ES6+ syntax**. For example, use `const` / `let` instead of `var`.  
- Prefer **arrow functions** for anonymous functions.  
- Use **async/await** for any asynchronous logic (no raw `.then` chains).  
- Do not use global libraries unless listed in `package.json`.  
- Follow these naming conventions:  
  - File names in `/automations`: `kebab-case.js` (e.g., `generate-pdf.js`).  
  - Function names: `camelCase`.  
  - Constants: `UPPER_SNAKE_CASE`.  
- Every function that performs I/O must return a `Promise`.  
- Use **JSDoc comments** for functions with nontrivial logic. Example:
  ```js
  /**
   * generateQuotePdf
   * Generates a PDF for a workstation quote with provided data.
   * @param {Object} quoteData - Details of the client’s quote.
   * @returns {Promise<string>} - Resolves to the file path of generated PDF.
   */
  async function generateQuotePdf(quoteData) { … }
````

* Run ESLint (configured by `.eslintrc.json`) on every AI-generated JavaScript file before merging.

---

### HTML / CSS

* All HTML pages under `/site` must begin with a standard DOCTYPE and `<html lang="en">`.
* Each HTML file must include:

  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clearline Field Systems – [Page Title]</title>
    <link rel="stylesheet" href="/assets/css/main.css" />
    <!-- No inline CSS in HTML files except for necessary overrides indicated in this Agents.md -->
  </head>
  <body>
    <!-- Page content -->
  </body>
  </html>
  ```
* Use **BEM naming** for CSS classes (block\_\_element--modifier).
* CSS variables (custom properties) must follow this palette:

  ```css
  :root {
    --primary-color: #0056b3;
    --secondary-color: #f7f7f7;
    --text-color: #333333;
    --border-color: #cccccc;
    --error-color: #cc0000;
    --success-color: forestgreen;
    --font-family: "Arial, sans-serif";
  }
  ```
* All new styles should live in `main.css` (or a new file under `/assets/css`, as long as it’s imported in `<head>`).
* Do not use CSS frameworks (no Bootstrap, no Tailwind). Rely on our custom BEM classes.

---

## Testing Protocols

All AI‐generated code must include or update unit tests under `/tests`. Use **Jest** for testing:

1. **Add or Update Tests**

   * Tests must use `describe()` and `it()` blocks.
   * Put related tests in the same file. Example: `/tests/calculator.test.js`

     ```js
     const { calculateTotal } = require('../site/assets/js/calculator');

     describe('calculateTotal', () => {
       it('returns 0 if no items selected', () => {
         expect(calculateTotal([])).toBe(0);
       });

       it('applies correct labor markup', () => {
         const items = [{ name: 'barebones', price: 350, qty: 2 }];
         const total = calculateTotal(items);
         // labor is baked in at 100% markup by default
         expect(total).toBe(700);
       });
     });
     ```
2. **Run Tests**

   * To run all tests:

     ```bash
     npm test
     ```
   * To run a single test file:

     ```bash
     npm test -- tests/calculator.test.js
     ```
   * To check coverage:

     ```bash
     npm test -- --coverage
     ```
3. **Ensure 100% Coverage on Critical Modules**

   * For `/automations` scripts, cover all branches (success, failure).
   * For `/site/assets/js/calculator.js`, cover price calculations and edge cases.

---

## Pull Request Guidelines

When an AI agent generates code and creates a PR on behalf of Clearline Field Systems, follow these rules:

1. **Branch Naming**

   * Use `feature/<short-description>` or `fix/<short-description>`. Example: `feature/quote-pdf-generation`.

2. **Commit Messages**

   * Use present tense, imperative mood. Example: `Add PDF generation for workstation quote`.

3. **PR Title & Description**

   * **Title**: Briefly summarize the change (max 50 characters).
   * **Description**:

     1. Link to related issue (if any).
     2. List major changes (bullet points).
     3. Highlight any breaking changes.
     4. Show where tests were added or updated.

   Example:

   ```
   Title: Generate PDF for workstation quote

   Description:
   - Added `generate-pdf.js` in /automations to create PDF from quote data
   - Updated `/site/templates/quote-template.html` with PDF placeholders
   - Wrote unit tests in `/tests/pdf-generation.test.js`
   - No breaking changes to existing functionality
   ```

4. **Code Review Checklist**

   * All tests pass (`npm test`).
   * ESLint reports no errors (`npm run lint`).
   * Type checks pass if using TypeScript (`npm run type-check`).
   * Manual smoke test performed for UI changes (open affected pages locally).
   * No unused imports or dead code.
   * Comments present for complex logic (per JSDoc guidelines).

5. **Merge Strategy**

   * Use “Squash and merge” to keep history clean.
   * Delete the feature branch after merging.

---

## Build & Deployment (Cloudflare)

Clearline Field Systems now uses Cloudflare Pages (and optionally Cloudflare Workers) for hosting the static site. AI agents should follow these instructions:

1. **Cloudflare Pages Setup**

   * The production site lives on **Cloudflare Pages** under the project name `clearlinesupport`.
   * IAM/API credentials for programmatic deployments are stored in the Cloudflare Pages dashboard and never in Git.
   * The default published branch is `main`.

2. **Local Preview**

   * Run a lightweight HTTP server from `site` folder for testing:

     ```bash
     cd site
     npx http-server -c-1 8080
     ```
   * Verify all pages load (index.html, about.html, contact.html, quote templates) at `http://localhost:8080`.

3. **Deploy to Cloudflare Pages**

   * Cloudflare Pages is configured to pull from GitHub’s `main` branch.
   * On each push to `main`, Cloudflare automatically builds and deploys `/site` as the root directory.
   * If AI generates new HTML, CSS, or JavaScript, ensure the changes are in `/site` before pushing.

4. **Environment Variables**

   * For any build-time variables (e.g., API endpoints), add them under Settings → Environment Variables in Cloudflare Pages.
   * Example:

     ```
     CF_ACCOUNT_ID=xxxxxxxxxxxxxxxx
     NODE_ENV=production
     ```
   * Do not commit any plaintext secrets to the repository.

5. **Cloudflare Workers (Optional)**

   * If backend logic (e.g., form submissions, PDF generation) is moved to Workers, place those scripts in `/workers` (create this folder if not present).
   * Workers must adhere to the same coding conventions (ES6+, async/await).
   * Example file structure if Workers are used:

     ```
     /workers
     ├── quote-handler.js
     └── invoice-handler.js
     ```
   * Workers are deployed via `wrangler.toml`, which lives in the repository root. Example:

     ```toml
     name = "clearlinesupport-workers"
     type = "javascript"
     account_id = "your-account-id"
     workers_dev = true
     route = ""
     zone_id = ""
     ```
   * Any AI-proposed changes to Workers must include instructions on how to run `wrangler publish` and test locally (`wrangler dev`).

6. **DNS & SSL (Cloudflare Dashboard)**

   * DNS records for `clearlinesupport.com` are managed in the Cloudflare DNS tab.

     * `A` record pointing to Cloudflare Pages (managed automatically by Pages).
     * `CNAME` records for `www` pointing to `<your-pages-subdomain>.pages.dev`.
   * SSL/TLS is set to “Full (strict)” under SSL/TLS settings.
   * Always force HTTPS under SSL/TLS → Edge Certificates (“Always Use HTTPS”).

7. **Cache & Performance**

   * Leverage Cloudflare’s CDN caching:

     * Static assets (`.css`, `.js`, `.png`, `.jpg`) have `Cache-Control: max-age=31536000, immutable`.
     * HTML pages have `Cache-Control: max-age=0, must-revalidate`.
   * If AI generates new assets, ensure proper `Cache-Control` headers are set in `_headers` file under `/site` (if using a static config). Example `_headers`:

     ```
     /assets/css/*
       Cache-Control: max-age=31536000, immutable

     /assets/js/*
       Cache-Control: max-age=31536000, immutable

     /*
       Cache-Control: max-age=0, must-revalidate
     ```
   * If `_headers` is not used, Cloudflare Page’s default caching is sufficient for our scale—no additional changes needed.

---

## Security & Compliance

Clearline Field Systems must comply with basic data protection and government contracting guidelines:

1. **Sensitive Data**

   * No API keys, passwords, or private certificates should be committed to Git.
   * Use environment variables in Cloudflare Pages or Workers for secrets. Example in Cloudflare Pages UI:

     ```
     TWILIO_ACCOUNT_SID: ACxxxxxxxxxxxxxxxx
     TWILIO_AUTH_TOKEN: your_auth_token
     EMAIL_SMTP_USER: user@example.com
     EMAIL_SMTP_PASS: SuperSecretPassword
     ```
   * Do not commit any `.env` or plaintext secrets to the repository.

2. **Dependencies**

   * Only approved NPM packages are allowed. The current `package.json` includes:

     ```json
     {
       "dependencies": {
         "puppeteer": "^20.0.0",
         "nodemailer": "^6.9.0"
       },
       "devDependencies": {
         "jest": "^29.0.0",
         "eslint": "^8.0.0"
       }
     }
     ```
   * If OpenAI Codex proposes a new dependency, verify license compatibility (MIT, Apache 2.0) before merging.

3. **Input Validation**

   * For any forms (quote calculator), validate all user inputs in JavaScript:

     * `Number.isInteger(qty) && qty > 0`
     * `typeof name === 'string' && name.trim().length > 0`
   * Sanitize any data before passing to PDF generator or email scripts.

4. **HTTPS Only**

   * Production URLs must use `https://`.
   * If an AI proposal includes linking to `http://`, replace with `https://` or use protocol-relative URL (`//`).

5. **Compliance Reminder**

   * As a SAM.gov–registered vendor (CAGE: 12QZ0, UEI: P53GQNQ41C74), Clearline Field Systems must keep its site secure.
   * Any AI suggestion for storing or transmitting sensitive PII data must be flagged and reviewed by a human.

---

## Contact & Support

If you (or any AI agent) need clarifications on this Agents.md file or any project details, contact:

* **Andre Smith**

  * Email: [andre@clearlinesupport.com](mailto:andre@clearlinesupport.com)
  * Phone/SMS: (518) XXX-XXXX

For faster responses regarding AI‐generated code, label GitHub issues with `agent-review` and assign to Andre.

```
```
